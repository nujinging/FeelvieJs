<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="../css/reset.css" />
    <link rel="stylesheet" href="../css/detail.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="../services/movieApi.js"></script>
    <title>Document</title>
  </head>
  <body>
    <div id="root"></div>

    <script>
    const render = async (type, id) => {
        const fetchBasic = await movieApi.detail(type, id);
        const fetchSocial = await movieApi.social(type, id);
        const data = fetchBasic.data;
        const socialData = fetchSocial.data;

        console.log(data);
        console.log(socialData);

        const transAdult = age => {
            return age == false ? "애들은자라" : "므흣";
        };

        const transRuntime = runtime => {
            const hour = Math.floor(runtime / 60);
            const minute = Math.floor(((runtime / 60) * 100) / 10);

            return `${hour}시간 ${minute}분`;
        };

        const handleSocial = () => {
            const socialMedia = [
                {name: '페이스북', url: 'http://www.facebook.com', class: "facebook", link: `${socialData?.facebook_id}`},
                {name: '트위터', url: 'http://www.twitter.com', class: "twitter", link: `${socialData?.twitter_id}`},
                {name: '인스타그램', url: 'http://www.instagram.com', class: "instagram", link: `${socialData?.instagram_id}`}
            ];
            
            const socialTemplate = socialMedia.map((social) => 
            !!social.link ? (
                `<li>
                    <a 
                        href="${social.url}/${social.link}"
                        class="${social.class}"
                        target="_blank"
                        rel="noreferrer"
                    >
                        <span class="blind">${social.name}</span>
                    </a>
                </li>`
            ) : null).join("");
            return socialTemplate;
        }

        const detailTemplate = `
        <section
            class="detail_container"
            style="background-image: url('https://image.tmdb.org/t/p/w1920_and_h800_multi_faces/${data.backdrop_path}');"
        >
            <div class="detail_info">
                <h1 class="tit">${data.title}</h1>
                <div class="meta">
                    <span class="type">Moive</span><span class="date">${data.release_date}</span>
                </div>
                <div class="meta">
                    <span class="txt">${transAdult(data.adult)}</span>
                    <span class="txt">${data.genres[0].name}</span>
                    <span class="txt">범죄</span><span class="txt">${data.genres[1].name}</span>
                </div>
                <div class="comment">
                    <p class="intro">${data.overview}</p>
                </div>
            </div>
            <div class="detail_poster">
                <ul class="social_links">${handleSocial()}</ul>
                <picture
                ><img
                    src="https://media.themoviedb.org/t/p/w300_and_h450_bestv2${data.poster_path}"
                    alt="Movie Poster"
                    loading="lazy"
                /></picture>
            </div>
        </section>
        `;
        document.querySelector("#root").innerHTML = detailTemplate;
      };
      render("movie","609681");
    </script>
  </body>
</html>
